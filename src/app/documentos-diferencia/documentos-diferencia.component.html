<div class="container mt-4">
    <div class="card shadow-lg rounded">
      <div class="card-header" style="background-color: #28a745; color: white;">
        <h2>Documentos de Diferencia</h2>
      </div>
      <div class="card-body">
        <button class="btn btn-primary mb-3" data-toggle="modal" style="background-color: grey;" data-target="#createGuiaModal">Crear Documento de Diferencia</button>
        <div class="table-responsive">
          <table class="table table-hover table-bordered mt-3">
            <thead class="thead-">
              <tr>
                <th>Número de Documento</th>
                <th>Número de Traspaso</th>
                <th>Número de Guía de Salida</th>
                <th>Número de Guía de Entrada</th>
                <th>Fecha</th>
                <th>Motivo</th>
                <th>Descripción</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let entry of documentoDiferencia; let i = index" [ngClass]="{'table-success': i % 2 === 0, 'table-light': i % 2 !== 0}">
                <td>{{ entry.numeroTraspaso }}</td>
                <td>
                  <a href="#" (click)="openDetailModal(entry)" data-toggle="modal" data-target="#detailGuiaModal">{{ entry.numeroDocumento }}</a>
                </td>
                <td>{{ entry.numeroDocumento }}</td>
                <td>{{ entry.numeroTraspaso }}</td>
                <td>{{ entry.numeroGuiaSalida }}</td>
                <td>{{ entry.numeroGuiaEntrada }}</td>
                <td>{{ entry.fecha }}</td>
                <td>{{ entry.motivo }}</td>
                <td>{{ entry.descripcion }}</td>
               
                <td>
                  <button (click)="removeEntry(i)" class="btn btn-danger btn-sm">Eliminar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal for Creating -->
  <div class="modal fade" id="createGuiaModal" tabindex="-1" role="dialog" aria-labelledby="createGuiaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content border-with-title rounded">
        <div class="modal-header">
          <h5 class="modal-title text-center" id="createGuiaModalLabel">Crear Documento de Diferencia</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="addEntry()" class="form">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-2 border p-3 rounded">
                  <label for="numeroTraspaso">Número de Solicitud de Traspasos</label>
                  <select [(ngModel)]="newEntry.numeroTraspaso" class="form-control" id="numeroTraspaso" name="numeroTraspaso" required (change)="selectTraspaso(newEntry.numeroTraspaso)">
                    <option *ngFor="let solicitud of solicitudTraspasos" [value]="solicitud.numeroGuia">{{ solicitud.numeroGuia }}</option>
                  </select>
                </div>
                <div class="form-group mb-2 border p-3 rounded">
                  
                  <div class="form-group mb-2">
                    <label for="numeroGuiaSalida">Número de Guía de Salida</label>
                    <div class="d-flex">
                      <select [(ngModel)]="newEntry.numeroGuiaSalida" class="form-control form-control-sm w-50" id="numeroGuiaSalida" name="numeroGuiaSalida" required>
                        <option *ngFor="let guia of filteredGuiasSalida" [value]="guia.numeroGuia">{{ guia.numeroGuia + ' - ' + guia.descripcion }}</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group mb-2">
                    <label for="numeroGuiaEntrada">Número de Guía de Entrada</label>
                    <div class="d-flex">
                      <select [(ngModel)]="newEntry.numeroGuiaEntrada" class="form-control form-control-sm w-50" id="numeroGuiaEntrada" name="numeroGuiaEntrada" required>
                        <option *ngFor="let guia of filteredGuiasEntrada" [value]="guia.numeroGuia">{{ guia.numeroGuia + ' - ' + guia.descripcion }}</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group mb-2">
                    <label for="motivo">Motivo</label>
                    <select [(ngModel)]="newEntry.motivo" class="form-control" id="motivo" name="motivo" required>
                      <option value="" disabled selected>Seleccione un motivo</option>
                      <option value="Falta de inventario">Falta de inventario</option>
                      <option value="Error en la documentación">Error en la documentación</option>
                      <option value="Problemas de transporte">Problemas de transporte</option>
                      <option value="Otros">Otros</option>
                    </select>
                  </div>
                  <div class="form-group mb-2 d-flex">
                    <div class="w-50 mr-2">
                      <label for="fecha">Fecha</label>
                      <input type="date" [(ngModel)]="newEntry.fecha" class="form-control form-control-sm" id="fecha" name="fecha" required>
                    </div>
                  </div>
                
                  <div class="form-group mb-2">
                    <label for="descripcion">Descripción</label>
                    <textarea [(ngModel)]="newEntry.descripcion" class="form-control" id="descripcion" name="descripcion"></textarea>
                  </div>
                  
                </div>
              </div>
            </div>
            
            <div class="form-group mb-2">
              <label for="productos">Productos</label>
              <table class="table table-bordered mb-2">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Total</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of newEntry.productos; let i = index">
                    <td>
                      <select [(ngModel)]="product.nombre" class="form-control" name="producto-{{i}}" required>
                        <option *ngFor="let producto of productos" [value]="producto">{{ producto }}</option>
                      </select>
                    </td>
                    <td>
                      <input type="number" [(ngModel)]="product.cantidad" class="form-control" placeholder="Cantidad" name="cantidad-{{i}}" required>
                    </td>
                    <td>
                      <input type="text" [(ngModel)]="product.precioUnitario" class="form-control" placeholder="Precio Unitario" name="precioUnitario-{{i}}" required>
                    </td>
                    <td>
                      <input type="text" [(ngModel)]="product.Total" class="form-control" placeholder="Total" name="Total-{{i}}" required>
                    </td>
                    <td>
                      <button type="button" class="btn btn-danger btn-sm" (click)="removeProduct(i)">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <button type="button" class="btn btn-primary mt-2" data-toggle="modal" data-target="#addProductModal">Agregar Producto desde Modal</button>
            </div>
            <button type="submit" class="btn btn-success mb-2">Agregar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal for Details -->
  <div class="modal fade" id="detailGuiaModal" tabindex="-1" role="dialog" aria-labelledby="detailGuiaModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded">
        <div class="modal-header">
          <h5 class="modal-title" id="detailGuiaModalLabel">Detalles de la Guía de Salida</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p><strong>Número de Documento:</strong> {{ selectedEntry?.numeroDocumento }}</p>
          <p><strong>Número de Traspaso:</strong> {{ selectedEntry?.numeroTraspaso }}</p>
          <p><strong>Número de Guía de Salida:</strong> {{ selectedEntry?.numeroGuiaSalida }}</p>
          <p><strong>Número de Guía de Entrada:</strong> {{ selectedEntry?.numeroGuiaEntrada }}</p>
          <p><strong>Fecha:</strong> {{ selectedEntry?.fecha }}</p>
          <p><strong>Motivo:</strong> {{ selectedEntry?.motivo }}</p>
          <p><strong>Descripción:</strong> {{ selectedEntry?.descripcion }}</p>
          <h5>Productos:</h5>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of selectedEntry?.productos">
                <td>{{ product.nombre }}</td>
                <td>{{ product.cantidad }}</td>
                <td>{{ product.precioUnitario }}</td>
                <td>{{ product.Total }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded">
        <div class="modal-header">
          <h5 class="modal-title" id="addProductModalLabel">Agregar Producto</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="addProduct()" class="form">
            <div class="form-group mb-2">
              <label for="productoNombre">Nombre del Producto</label>
              <select [(ngModel)]="newProduct.nombre" class="form-control" id="productoNombre" name="productoNombre" required>
                <option *ngFor="let producto of productos" [value]="producto">{{ producto }}</option>
              </select>
            </div>
            <div class="form-group mb-2">
              <label for="productoCantidad">Cantidad</label>
              <input type="number" [(ngModel)]="newProduct.cantidad" (input)="calculateTotal()" class="form-control" id="productoCantidad" name="productoCantidad" required>
            </div>
            <div class="form-group mb-2">
              <label for="productoPrecioUnitario">Precio Unitario</label>
              <input type="text" [(ngModel)]="newProduct.precioUnitario" (input)="calculateTotal()" class="form-control" id="productoPrecioUnitario" name="productoPrecioUnitario" required>
            </div>
            <div class="form-group mb-2">
              <label for="productoTotal">Total</label>
              <input type="text" [value]="newProduct.Total | number:'1.0-0'" class="form-control" id="productoTotal" name="productoTotal" readonly>
            </div>
            <button type="submit" class="btn btn-success mb-2">Agregar Producto</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  